<!doctype html>
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en"> <![endif]-->
<!--[if IE 8]>    <html class="no-js lt-ie9" lang="en"> <![endif]-->
<!-- Consider adding a manifest.appcache: h5bp.com/d/Offline -->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"> <!--<![endif]-->
<head>
  <meta charset="utf-8">

  <!-- Use the .htaccess and remove these lines to avoid edge case issues.
       More info: h5bp.com/i/378 -->
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

  <title>
    
         Shell Script to Forward iTunes Library to Remote Machine via SSH
    
  </title>
  <meta name="description" content="">

  <!-- Mobile viewport optimized: h5bp.com/viewport -->
  <!--<meta name="viewport" content="width=device-width">-->
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
  <!-- Place favicon.ico and apple-touch-icon.png in the root directory: mathiasbynens.be/notes/touch-icons -->

  <link rel="stylesheet" href="/css/style.css">

  <!-- More ideas for your <head> here: h5bp.com/d/head-Tips -->

  <!-- All JavaScript at the bottom, except this Modernizr build.
       Modernizr enables HTML5 elements & feature detects for optimal performance.
       Create your own custom Modernizr build: www.modernizr.com/download/ -->
  <script src="/js/libs/modernizr-2.5.3.min.js"></script>
</head>
<body>

  <!-- Prompt IE 6 users to install Chrome Frame. Remove this if you support IE 6.
       chromium.org/developers/how-tos/chrome-frame-getting-started -->
  <!--[if lt IE 7]><p class=chromeframe>Your browser is <em>ancient!</em> <a href="http://browsehappy.com/">Upgrade to a different browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">install Google Chrome Frame</a> to experience this site.</p><![endif]-->
  <header>
  </header>

    <div role="main" style="height: 100%">
        <div class="content clearfix" style="height: 100%;">
            <article role="main" style="height: 100%;">
            <div id="column">
              <h1>
                
                Shell Script to Forward iTunes Library to Remote Machine via SSH
                
              </h1>
                <div id="back" style="margin-bottom:10px;">
    <a href="/">Back to home</a>
</div>

<div id="post">
<p><em>Note: I originally posted this on <a href='http://forr.st/~D4u'>Forrst</a>.</em></p>

<p>I like to keep my music collection fairly centralized. Instead of having my music files spread out amongst various home and work computers, I have a machine at home host my iTunes/DAAP music library via <a href='https://github.com/jasonmc/forked-daapd'>forked-daapd</a> (although one could just as easily leave a computer running iTunes open).</p>

<p>This shell script, tested on OS X 10.6, connects to my home machine via SSH and forwards the DAAP port to my remote machine. There are a few <a href='http://blog.iharder.net/2009/09/28/itunes-stream-itunes-over-ssh/'>blog posts</a> out there that describe how to do this, but this is the script I eventually landed on. If you have any suggestions for improvements, please <a href='mailto:matt@mtmckenna.com'>let me know</a>.</p>

<p>You&#8217;ll need to be able to <a href='http://superuser.com/questions/104929/how-do-you-run-a-ssh-server-on-mac-os-x'>log into your home machine via SSH</a>. To connect outside your own LAN, you&#8217;ll also need to configure your router at home to forward the SSH port (default: 22) to whatever machine is hosting your iTunes library.</p>

<p>Here&#8217;s the shell script:</p>
<div class='highlight'><pre><code class='bash'>    <span class='nv'>local_username</span><span class='o'>=</span><span class='s2'>&quot;your_username&quot;</span>
    <span class='nv'>ssh_username</span><span class='o'>=</span><span class='s2'>&quot;your_ssh_username&quot;</span>
    <span class='nv'>ssh_server</span><span class='o'>=</span><span class='s2'>&quot;your_ssh_server.com&quot;</span>
    <span class='nv'>share_name</span><span class='o'>=</span><span class='s2'>&quot;ssh iTunes&quot;</span>

    <span class='nb'>kill</span> <span class='sb'>`</span>ps -U <span class='s2'>&quot;$local_username&quot;</span> | grep ssh | grep <span class='s2'>&quot;:36890:127.0.0.1:3689 $ssh_username@$ssh_server&quot;</span> | awk <span class='s1'>&#39;{ print $1 }&#39;</span><span class='sb'>`</span>
    <span class='nb'>kill</span> <span class='sb'>`</span>ps -U <span class='s2'>&quot;$local_username&quot;</span> | grep dns-sd | grep <span class='s2'>&quot;$share_name&quot;</span> | awk <span class='s1'>&#39;{ print $1 }&#39;</span><span class='sb'>`</span>
    ssh -p 22 -fNL :36890:127.0.0.1:3689 <span class='s2'>&quot;$ssh_username@$ssh_server&quot;</span>
    dns-sd -R <span class='s2'>&quot;$share_name&quot;</span> _daap._tcp <span class='nb'>local </span>36890 &amp;
</code></pre></div>
</div>

<div id="disqus">
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'mtmckenna'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<div id="related">
  <h2>Related Posts</h2>
  <ul class="posts">
    
      <li><span>26 Nov 2011</span> &raquo; <a href="/posts/2011/11/26/incremental-backup-rsync-ssh">Incremental, Snapshot-based Backup with Rsync and SSH</a></li>
    
  </ul>
</div>

<link rel="stylesheet" href="/css/syntax.css">

            </div>
            </article>
        </div>
        <img id="earth" src="/img/bg-earth.gif">
        <img id="moon" src="/img/bg-moon.gif">
        <canvas id="bg-canvas" width="100" height="100"></canvas>
    </div>
    <footer>

    </footer>

    <!-- JavaScript at the bottom for fast page loading -->

    <!-- Grab Google CDN's jQuery, with a protocol relative URL; fall back to local if offline -->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="/js/libs/jquery-1.7.1.min.js"><\/script>')</script>

  <!-- scripts concatenated and minified via build script -->
  <script src="/js/plugins.js"></script>
  <script src="/js/script.js"></script>
  <!-- end scripts -->

  <!-- Asynchronous Google Analytics snippet. Change UA-XXXXX-X to be your site's ID.
       mathiasbynens.be/notes/async-analytics-snippet -->
  <script>
    var _gaq=[['_setAccount','UA-22416394-1'],['_trackPageview']];
    (function(d,t){var g=d.createElement(t),s=d.getElementsByTagName(t)[0];
    g.src=('https:'==location.protocol?'//ssl':'//www')+'.google-analytics.com/ga.js';
    s.parentNode.insertBefore(g,s)}(document,'script'));
  </script>
</body>
</html>
